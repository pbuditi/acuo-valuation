plugins {
    id 'io.franzbecker.gradle-lombok' version '1.6'
}

apply from: "$rootDir/gradle/java-plugins.gradle"
apply from: "$rootDir/gradle/dependencies.gradle"
apply from: "$rootDir/gradle/integration-test.gradle"
apply from: "$rootDir/gradle/deployment.gradle"
apply from: "$rootDir/gradle/sonarqube.gradle"
apply from: "$rootDir/gradle/test-reports.gradle"

repositories {
    jcenter()
    mavenLocal()
    mavenCentral()
    maven {
        url "${nexusUrl}/repository/maven-public/"
    }
}

configurations.all {
    // check for updates every build
    resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
}

ext.versions += [
        common          : '0.0.1-SNAPSHOT',
        mapping         : '0.0.1-SNAPSHOT',
        okhttp          : '3.3.1',
        eclipselink     : '2.6.3',
        guice           : '4.0',
        resteasy        : '3.0.19.Final',
        jackson         : '2.8.3',
        metrics         : '3.1.2',
        metricsguice    : '3.1.3'
]

dependencies {
    compile("com.acuo.collateral:common:${versions.common}") { changing = true }
    compile("com.acuo.collateral:mapping:${versions.mapping}") { changing = true }
    compile(
            "org.codehaus.groovy:groovy-all:2.4.7",
            "com.google.inject:guice:${versions.guice}",

            "org.eclipse.persistence:eclipselink:${versions.eclipselink}",
            "com.sun.xml.bind:jaxb-xjc:2.2.11",

            "org.jboss.resteasy:resteasy-jaxrs:${versions.resteasy}",
            "org.jboss.resteasy:resteasy-guice:${versions.resteasy}",
            "org.jboss.resteasy:resteasy-html:${versions.resteasy}",
            "org.jboss.resteasy:resteasy-jackson2-provider:${versions.resteasy}",

            "com.fasterxml.jackson.datatype:jackson-datatype-jdk8:${versions.jackson}",
            "com.fasterxml.jackson.datatype:jackson-datatype-jsr310:${versions.jackson}",
            "com.fasterxml.jackson.datatype:jackson-datatype-joda:${versions.jackson}",

            "com.smokejumperit.guice:core:1.1",

            "org.apache.velocity:velocity:1.7",

            "org.modelmapper:modelmapper:0.7.5",
            "io.dropwizard.metrics:metrics-core:${versions.metrics}",
            "io.dropwizard.metrics:metrics-jvm:${versions.metrics}",
            "io.dropwizard.metrics:metrics-servlets:${versions.metrics}",
            "com.palominolabs.metrics:metrics-guice:${versions.metricsguice}",
            "org.jasypt:jasypt:1.9.2",

            "com.opengamma.strata:strata-product:0.15.0",
            "com.xebia:jackson-lombok:1.1"
    )

    testCompile(
            "com.acuo.collateral:common:${versions.common}:tests",
            "com.squareup.okhttp3:mockwebserver:${versions.okhttp}",
            "org.xmlunit:xmlunit-core:2.2.0",
            "org.xmlunit:xmlunit-matchers:2.2.0",
            "net.javacrumbs.json-unit:json-unit:1.12.1",
            "net.javacrumbs.json-unit:json-unit-fluent:1.12.1",
            "com.jayway.jsonpath:json-path-assert:2.2.0",
            "org.meanbean:meanbean:2.0.3",
            "nl.jqno.equalsverifier:equalsverifier:2.1.6"
    )
}

apply plugin: 'application'

mainClassName = 'com.acuo.valuation.ValuationApp'
applicationDefaultJvmArgs = ["-Dacuo.config.appid=${config.appId}",
                             "-Dacuo.config.env=${config.env}",
                             "-Dacuo.security.key=${config.key}"]